From bfaecf43b8d58fbe3af6318550379a89d7058adb Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Wed, 19 Nov 2025 14:42:54 +0100
Subject: [PATCH] iphlpapi: Add semi-stub for GetOwnerModuleFromTcpEntry.

Needed from https://store.steampowered.com/app/3887700/Girls_Frontline
---
 dlls/iphlpapi/iphlpapi.spec   |  2 +-
 dlls/iphlpapi/iphlpapi_main.c | 48 +++++++++++++++++++++++++++++++++++
 2 files changed, 49 insertions(+), 1 deletion(-)

diff --git a/dlls/iphlpapi/iphlpapi.spec b/dlls/iphlpapi/iphlpapi.spec
index ed2214c99ce..ed05b0d46db 100644
--- a/dlls/iphlpapi/iphlpapi.spec
+++ b/dlls/iphlpapi/iphlpapi.spec
@@ -124,7 +124,7 @@
 @ stdcall GetNumberOfInterfaces( ptr )
 #@ stub GetOwnerModuleFromPidAndInfo
 #@ stub GetOwnerModuleFromTcp6Entry
-#@ stub GetOwnerModuleFromTcpEntry
+@ stdcall GetOwnerModuleFromTcpEntry( ptr long ptr ptr )
 #@ stub GetOwnerModuleFromUdp6Entry
 #@ stub GetOwnerModuleFromUdpEntry
 @ stdcall GetPerAdapterInfo( long ptr ptr )
diff --git a/dlls/iphlpapi/iphlpapi_main.c b/dlls/iphlpapi/iphlpapi_main.c
index 7f39d771f61..e0086b0d391 100644
--- a/dlls/iphlpapi/iphlpapi_main.c
+++ b/dlls/iphlpapi/iphlpapi_main.c
@@ -49,6 +49,15 @@ WINE_DEFAULT_DEBUG_CHANNEL(iphlpapi);
 
 static const WCHAR *device_tcpip = L"\\DEVICE\\TCPIP_";
 
+typedef enum _TCPIP_OWNER_MODULE_INFO_CLASS {
+    TCPIP_OWNER_MODULE_INFO_BASIC = 0
+} TCPIP_OWNER_MODULE_INFO_CLASS, *PTCPIP_OWNER_MODULE_INFO_CLASS;
+
+typedef struct _TCPIP_OWNER_MODULE_BASIC_INFO {
+    PWCHAR pModuleName;
+    PWCHAR pModulePath;
+} TCPIP_OWNER_MODULE_BASIC_INFO, *PTCPIP_OWNER_MODULE_BASIC_INFO;
+
 DWORD WINAPI AllocateAndGetIpAddrTableFromStack( MIB_IPADDRTABLE **table, BOOL sort, HANDLE heap, DWORD flags );
 
 static const NPI_MODULEID *ip_module_id( USHORT family )
@@ -5292,3 +5301,42 @@ DWORD WINAPI SetCurrentThreadCompartmentId( NET_IF_COMPARTMENT_ID id )
     FIXME( "(%x): stub\n", id );
     return ERROR_SUCCESS;
 }
+
+/***********************************************************************
+*    GetOwnerModuleFromTcpEntry (IPHLPAPI.@)
+*/
+DWORD WINAPI GetOwnerModuleFromTcpEntry(
+    PMIB_TCPROW_OWNER_MODULE pTcpEntry,
+    TCPIP_OWNER_MODULE_INFO_CLASS Class,
+    PVOID pBuffer,
+    PDWORD pdwSize)
+{
+    TCPIP_OWNER_MODULE_BASIC_INFO *info;
+    DWORD needed;
+    
+    TRACE("(%p, %d, %p, %p)\n", pTcpEntry, Class, pBuffer, pdwSize);
+
+    if (!pTcpEntry || !pdwSize)
+        return ERROR_INVALID_PARAMETER;
+    
+    if (Class != TCPIP_OWNER_MODULE_INFO_BASIC)
+        return ERROR_INVALID_PARAMETER;
+
+    needed = sizeof(TCPIP_OWNER_MODULE_BASIC_INFO) + 2 * sizeof(WCHAR);
+
+    if (!pBuffer || *pdwSize < needed)
+    {
+        *pdwSize = needed;
+        return ERROR_INSUFFICIENT_BUFFER;
+    }
+
+    info = (TCPIP_OWNER_MODULE_BASIC_INFO *)pBuffer;
+    memset(info, 0, sizeof(*info));
+    
+    info->pModuleName = (WCHAR *)((BYTE *)pBuffer + sizeof(TCPIP_OWNER_MODULE_BASIC_INFO));
+    info->pModulePath = info->pModuleName;
+    info->pModuleName[0] = L'\0';
+    info->pModulePath[0] = L'\0';
+    
+    return NO_ERROR;
+}
\ No newline at end of file
-- 
2.51.2

